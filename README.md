# Komm-Uchet-1C
Программа учета коммунальных услуг для потребителя

**Данная конфигурация позволяет вести учет передачи показаний УК или ресурсоснабжающим компаниям, а также фиксировать себе факт оплаты по счетам. Также имеется возможность дистанционно передавать данные через написанный микросервис (раздел "Интеграция") :hugs: .**

> Режим совместимости 1С: Версия 8.3.20.

## Передача показаний

:left_speech_bubble:Имеется возможность также просто передавать показания без необходимости оплаты по счетчику (если все платежи идут единой квитанцией). Для этого имеется в настройках счетчика флаг "Передавать данные". 

:left_speech_bubble:Сами данные передаются на микросервис, который фиксирует отправленные показания для конкретного клиента (очереди в брокере Rabbit) в базе данных Postgresql.

:left_speech_bubble:Клиент вычитывает эти данные по наименованию очереди используя стороннее мобильное приложение ***"REST Client"*** (разработчик: Pawan Singh Chauhan). Передача данных от мобильного клиента производится путем отправки сообщения в Rabbit, после чего его может получить конфигурация 1С, путем отправки GET-запроса. Дистанционную передачу можно в любой момент отключить в настройках счетчиков квартиры.

:left_speech_bubble:Поддерживается передача показаний счетчиков, обладающих дневным и ночным тарифом (для электроэнергии, тип счетчика - двухпозиционный ЭЭ).

:left_speech_bubble:Если все показания за месяц переданы - передача показаний в текущем месяце будет недоступна (отобразится сообщение). Показания следует передавать все сразу.

:left_speech_bubble:Также имеется возможность хранить фото паспорта счетчика и отображать его поверки.

## Фиксация факта оплаты

Фиксация оплаты происходит по следующим типам тарифов: электроэнергия, холодная вода, горячая вода, водоотведение, отопление, интернет, капремонт, вывоз мусора и оплата УК.

**Имеется возможность оплачивать частями. Если все оплаты за месяц проведены - оплата в текущем месяце будет недоступна (отобразится сообщение).**

## Работа мобильного клиента

1. Установить стороннее мобильное приложение ***"REST Client"*** (разработчик: Pawan Singh Chauhan);

2. Для получения показаний:
   
- создать GET-запрос и указать следующий RequestUrl: _https://81.94.159.134:7450/andrGet_;
- указать следующие параметры:
 1. client: _название созданной очереди в 1С_
 2. login: _mary_
 3. token: _egbtw2yoQe_.
- нажать _"Send"_.
  
3. Для передачи показаний:
   
- создать POST-запрос и указать следующий RequestUrl: _https://81.94.159.134:7450/andrSend_;<br/>
- указать следующие параметры:<br/>
 1. client: _название созданной очереди в 1С_ <br/>
 2. login: _mary_<br/>
 3. token: _egbtw2yoQe_.<br/>
- создать тело запроса (Body) и нажать _"Send"_.
  
***Логин и токен необходимы для авторизации на сервисе.***
  
Тело запроса содержит префиксы счетчиков и передаваемые показания, указанные в формате (каждый счетчик с новой строки):
_ПрефиксСчетчика=Показание1=Показание2_ - если счетчик двухпозиционный
или _ПрефиксСчетчика=Показание1=0_ - если счетчик НЕ двухпозиционный.<br/>
Например,<br/>
_Сч1=100.345=0<br/>
Сч2=10.345=15_

**Будет отображено сообщение об отправке или зафиксированные в 1С показатели с префиксами счетчиков.**

## Начало работы с конфигурацией

1.Добавление квартиры и всех счетчиков (услуг), которыми она пользуется. Возможна для счетчика ТОЛЬКО передача показаний (при необходимости) (_Показания и платежи - Справочники - Квартиры_);

2.Установление действующих тарифов (_Показания и платежи - Операции - Установить тарифы_);

3. Передать показания (_Показания и платежи - Создать - Передать показания_);
   
5. Фиксация факта оплаты (_Показания и платежи - Создать - Выполнить оплату_) с указанием тех пунктов квитанции, которые необходимы;
   
5.Выполнение и просмотр отчетов (_Показания и платежи - Отчеты_).

***Тариф на "Обслуживание дома" является плавающим и устанавливается каждый раз равным сумме предыдущей оплаты***.

6.Для включения дистанционной оплаты следует включить опцию "Удаленная передача данных" (_Показания и платежи - Сервис - Настройки_), а после разрешить передачу данных по конкретной квартире (_флаг "Передавать данные"_) с указанием наименования клиента.

7.Имеется возможность администрирования системы из режима 1С:Предприятия, выбрав опцию "Раздел для администратора" (_Показания и платежи - Сервис - Настройки_).

## Интеграция (Удаленная передача данных)

> НЕОБХОДИМ ДОСТУП К ИНТЕРНЕТУ

1.После включения опции станет доступна соответствующая подсистема. Для начала следует указать параметры для соединения с сервисом (_Интеграция - Параметры rabbit_):

- Наименование: _любая строка_;<br/>
- Активный: _Истина_;<br/>
- Хост: _81.94.159.134_;<br/>
- Порт: _7450_;<br/>
- Логин: _mary_;<br/>
- Токен: _egbtw2yoQe_.
 
2.Далее добавляем нового клиента в Rabbit (_Интеграция - Сервис - Добавить/удалить клиента_): для этого указываем наименование клиента и нажимаем "Добавить клиента" (_если он еще не существует_) или "Удалить клиента" (_если он существует_).

  **Список зафиксированных в 1С клиентов находится в Интеграция - Добавленные клиенты.**

## Отчеты (_Показания и платежи - Отчеты_)

Для формирования отчетов следует выбрать квартиру и указать период в году, за который требуется вывести годовой отчет.
